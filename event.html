<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>com4j - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/1024px.css");
      @import url("./css/site.css");
    </style>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body>
    <div id="wrap2"><div id="wrap">
    <div id="header">
      <p id="toplinks">Skip to: <a href="#content">Content</a> | <a href="#sidebar">Navigation</a> | <a href="#footer">Footer</a></p>
		
            <h1 id="bannerLeft">
          <a href="">
    
            com4j
    
            </a>
        </h1>
                
      <p id="slogan">Type-safe Java/COM bridge</p>
    </div>
    <div id="breadcrumbs">
      <div class="xright">  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>

    <div id="sidebar">
      <div id="navcolumn">
              <h2>
          com4j
        </h2><ul>
              
    <li class="none">
              <a href="index.html">Introduction</a>
        </li>
              
    <li class="none">
              <a href="https://github.com/kohsuke/com4j/downloads">Download</a>
        </li>
              
    <li class="none">
              <a href="https://github.com/kohsuke/com4j">Source code</a>
        </li>
              
    <li class="none">
              <a href="http://java.net/jira/browse/COM4J">Bugs</a>
        </li>
          </ul>
      <h2>
          References
        </h2><ul>
              
    <li class="none">
              <a href="apidocs/index.html">Javadoc</a>
        </li>
          </ul>
      <h2>
          Project Documentation
        </h2><ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>
              
                
              
      
            
      
              
        <li class="collapsed">
              <a href="project-reports.html">Project Reports</a>
              </li>
          </ul>
        </div>
    </div>
    <div id="content">
      <div id="contentBox">
        <h1>com4j Event Handling</h1>

<p>This document explains how you can subscribe to COM events.</p>

<h2>Event Interface Definition</h2>

<p>To subscribe to COM events, you first need an interface that defines the IID of the event interface,
plus event methods that you'd like to subscribe, such as this:</p>

<pre><code>@IID("{5846EB78-317E-4B6F-B0C3-11EE8C8FEEF2}")
public interface _IiTunesEvents {
    /**
     * Fired when a database change occurs.
     */
    @DISPID(1)
    void onDatabaseChangedEvent(Object deletedObjectIDs, Object changedObjectIDs);

    /**
     * Fired when a track has started playing.
     */
    @DISPID(2)
    void onPlayerPlayEvent(Object iTrack);
}
</code></pre>

<p>An event interface does not have to list all the event methods; if you omit some methods, those events
will be simply ignored. Also, technically the event interface can be a class &mdash; the only thing
required is the <code>@IID</code> annotation and <code>@DISPID</code> that designates which are event methods.</p>

<p>To make it easy to subscribe to COM events, tlbimp generate a class with empty methods.
But you can also choose to write it manually.</p>

<h2>Subscribe/Unsubscribe to events</h2>

<p>You can subscribe to a COM object by using the following code:</p>

<pre><code>Com4jObject comObject = ...; // more likely it's an interface derived from Com4jObject
EventCookie cookie = comObject.advise(_IiTunesEvents.class, new MyEventReceiver());

...

cookie.close(); // terminate subscription
</code></pre>

<p>Because of the reference counting in COM, you must explicitly perform unsubscription
by using the <code>close</code> method, or otherwise both COM and Java objects will leak.</p>

<h2>Event and Thread</h2>

<p>If your thread X invokes a COM method, which in turn fires an event Y, then the thread
that executes the event method Y will not be X, but a thread that com4j maintains internally.
So the acess to thread local resources need to be done carefully.
But note that there's no need of synchronization --- thread X blocks until your event code returns.</p>

<p>For some other kinds of events (such as iTunes playerStart/playerStop events), they
happen without you calling into COM first. Those events are delivered in
truly asynchronous ways, so you will need synchronization.</p>

      </div>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2014
    
          <a href="http://kohsuke.org/">Kohsuke Kawaguchi</a> and other contributors
          
  

  
  
  &nbsp;| Last Published: 03/27/2014
  &nbsp;| Version: 2.0-SNAPSHOT
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    </div></div>
  </body>
</html>
